<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Registration Form</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Poppins:wght@500;600;900&display=swap" rel="stylesheet">
    <style>
        /* General styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            color: #333;
            background-color: #D7EEDE;
            overflow-x: hidden;
        }

        /* Background with white filter */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('bg.jpg'); /* Replace with your background image */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.15; /* Subtle visibility */
            z-index: -1;
        }

        /* ===== NAVBAR STYLES ===== */
        .navbar-container {
            background-color: white;
            width: 100%;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1000;
        }

        .navbar-container header {
            height: 90px;
            padding: 0 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 100%;
            margin: 0 auto;
            box-sizing: border-box;
        }

        .hospital-container {
            display: flex;
            align-items: center;
            gap: 15px;
            height: 100%;
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            width: 60px;
            overflow: hidden;
        }

        .logo-container img {
            max-height: 79px;
            max-width: 100%;
            object-fit: contain;
        }

        .hospital-name {
            font-family: 'Poppins', sans-serif;
            font-size: 22px;
            font-weight: 600;
            color: #0B6A27;
            text-align: left;
            line-height: 1.2;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .hospital-line {
            margin: 0;
            padding: 0;
        }

        /* User info in navbar (not present in current HTML but good to keep for consistency) */
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background-color: #0B6A27;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 18px;
        }

        .user-name {
            font-weight: 600;
            font-size: 16px;
        }

        /* ===== DASHBOARD LAYOUT ===== */
        .dashboard-container {
            display: flex;
            margin-top: 90px; /* Height of navbar */
            min-height: calc(100vh - 90px);
        }

        /* Main content area */
        .main-content {
            flex: 1;
            padding: 30px;
            margin-left: 0; /* Adjusted for full width on smaller screens */
        }

        .dashboard-header {
            margin-bottom: 30px;
        }

        .dashboard-header h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 32px;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
            text-align: center;
            margin-left: 0;
            /* Adjusted for full width on smaller screens */
        }

        .dashboard-header p {
            color: #666;
            font-size: 16px;
            text-align: center;
            margin-left: 0; /* Adjusted for full width on smaller screens */
            font-weight: 500;
        }

        /* Appointment Form Styles */
        .appointment-container {
            max-width: 800px;
            margin: 0 auto;
        }

        /* Progress Indicator */
        .progress-container {
            margin-bottom: 30px;
            margin-right: 0; /* Adjusted for full width on smaller screens */
        }

        .progress-bar {
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 4px;
            margin-bottom: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: #0B6A27;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .progress-steps {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 5px;
            font-size: 12px;
            color: #666;
        }

        .progress-step {
            text-align: center;
            padding: 5px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .progress-step.active {
            color: #0B6A27;
            font-weight: 600;
            background-color: rgba(11, 106, 39, 0.1);
        }

        .progress-step.completed {
            color: #0B6A27;
            background-color: rgba(11, 106, 39, 0.05);
        }

        /* Form Container */
        .form-container {
            background-color: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
            margin-right: 0;
            /* Adjusted for full width on smaller screens */
            transition: opacity 0.4s ease, transform 0.4s ease;
        }

        .form-title {
            font-family: 'Poppins', sans-serif;
            font-size: 24px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        /* Default form-group styles (for single column fields) */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        /* Specific styles for labels and inputs that should be aligned horizontally */
        /* This targets form groups NOT directly inside a .form-row that would split them */
        .form-container .form-group:not(.form-row .form-group) {
            display: flex;
            /* Use flexbox for horizontal alignment */
            align-items: center;
            /* Vertically align items in the middle */
            margin-bottom: 15px;
            /* Adjust spacing as needed */
        }

        .form-container .form-group:not(.form-row .form-group) label {
            flex: 0 0 150px;
            /* Fixed width for the label. ***ADJUST THIS VALUE*** for perfect alignment */
            text-align: right;
            /* Align label text to the right */
            padding-right: 15px;
            /* Space between the label and the input field */
            margin-bottom: 0;
            /* Remove default block margin */
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-size: 16px;
            transition: border-color 0.3s ease;
            /* For flex items, ensure they take remaining space */
            flex: 1;
        }
        
        /* Specific styles for textarea */
        .form-group textarea {
            resize: none;
            /* Disable user resizing */
            overflow-y: hidden;
            /* Hide vertical scrollbar, as height will adjust */
            min-height: 80px;
            /* Set an initial height */
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: #0B6A27;
            outline: none;
            box-shadow: 0 0 0 3px rgba(11, 106, 39, 0.2);
            /* Light green shadow */
        }

        .form-row {
            display: flex;
            flex-wrap: wrap; /* Allows columns to wrap on smaller screens */
            margin-left: -10px;
            /* Counteract padding on columns */
            margin-right: -10px;
        }

        .form-row > .form-group {
            padding-left: 10px;
            padding-right: 10px;
            box-sizing: border-box;
            margin-bottom: 15px; /* Adjust spacing between rows */
            /* Reset flex for direct children of form-row, as they will use col-md-* */
            display: block;
            flex: unset; /* Remove flex property inherited from .form-group */
            align-items: unset;
            /* Remove align-items inherited from .form-group */
        }

        .form-row > .form-group label {
            text-align: left;
            /* Labels in columns should be left-aligned */
            padding-right: 0;
            flex: unset; /* Remove flex property inherited from .form-group label */
            width: 100%;
            /* Ensure label takes full width in its column */
            margin-bottom: 8px;
            /* Restore default margin bottom for labels in column */
        }

        /* Responsive columns for medium devices and up */
        @media (min-width: 768px) {
            .col-md-2 {
                flex: 0 0 16.666667%;
                max-width: 16.666667%;
            }
            .col-md-4 {
                flex: 0 0 33.333333%;
                max-width: 33.333333%;
            }
            .col-md-6 {
                flex: 0 0 50%;
                max-width: 50%;
            }
        }
        /* Default for smaller screens (full width) is handled by not having col-md- classes apply */
        @media (max-width: 767px) {
             .form-row > .form-group {
                flex: 0 0 100%;
                max-width: 100%;
            }
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
            /* Remove flex properties that might be inherited from .form-group input */
            flex: unset;
            padding: unset;
        }

        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            font-weight: normal;
            margin-bottom: 0;
            /* Remove flex properties that might be inherited from .form-group label */
            flex: unset;
            text-align: left;
            padding-right: 0;
        }

        .radio-group input[type="radio"] {
            width: auto;
            margin-right: 8px;
            /* Remove flex properties that might be inherited from .form-group input */
            flex: unset;
            padding: unset;
        }

        .unit-input {
            display: flex;
            gap: 10px;
            align-items: center;
            flex: 1; /* This makes the unit-input flex container take remaining space */
        }

        .unit-input input {
            flex: 2;
            /* input takes more space */
            width: auto;
            /* override 100% width */
        }

        .unit-input select {
            flex: 1;
            /* select takes less space */
            width: auto;
            /* override 100% width */
        }

        /* --- START: Medication Row Adjustments --- */
        .medication-row {
            display: block; /* Change to block to make items stack vertically */
            padding: 15px;
            border: 1px solid #eee;
            border-radius: 8px;
            margin-bottom: 20px; /* Space between medication rows */
            /* Removed position: relative; because the button will be inside a form-group now */
        }

        .medication-row .form-group {
            margin-bottom: 15px; /* Space between each input field within the row */
            display: block; /* Ensure form-group itself stacks vertically */
        }

        .medication-row .form-group label {
            display: block; /* Labels stack above inputs */
            text-align: left; /* Align labels left */
            padding-right: 0; /* Remove right padding */
            margin-bottom: 8px; /* Space between label and input */
            width: auto; /* Allow label width to be natural */
        }

        .medication-row .form-group input {
            width: 100%; /* Make inputs take full width */
            flex: unset; /* Override previous flex settings */
        }

        /* New style for the button container within medication-row */
        .medication-row .button-container {
            display: flex; /* Use flexbox to align button */
            justify-content: flex-end; /* Push button to the right */
            margin-top: 10px; /* Space above the button */
        }

        .medication-row .remove-medication-btn {
            /* No position absolute */
            padding: 8px 12px;
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            /* margin-left: auto; If the button itself was the flex item in a row */
        }

        /* Ensure add medication button is not affected */
        .add-medication-btn {
            background-color: #0B6A27;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 10px;
        }
        /* --- END: Medication Row Adjustments --- */

        .required::after {
            content: " *";
            color: #dc3545;
        }

        /* Age display styles */
        .age-display {
            margin-top: 8px;
            padding: 8px 12px;
            background-color: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #e9ecef;
            font-weight: 600;
            color: #0B6A27;
            font-size: 14px;
            /* To make it align with flexbox form-group */
            flex: 1;
        }

        /* Form Navigation for multi-step forms */
        .form-navigation {
            display: flex;
            justify-content: space-between; /* Pushes buttons to ends */
            margin-top: 30px;
        }
        /* Specific button container for individual right alignment */
        .personal-info-button-container {
            display: flex;
            justify-content: flex-end; /* Aligns the button to the right */
            margin-top: 20px;
            /* Space above the button */
            /* Adjust this padding-right if needed for alignment with other form elements */
            padding-right: 0px;
        }


        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
        }

        .btn-prev {
            background-color: #f0f0f0;
            color: #333;
        }

        .btn-prev:hover {
            background-color: #e0e0e0;
        }

        .btn-next {
            background-color: #0B6A27;
            color: white;
        }

        .btn-next:hover {
            background-color: #095020;
        }

        .btn-submit {
            background-color: #0B6A27;
            color: white;
        }

        .btn-submit:hover {
            background-color: #095020;
        }

        /* Receipt Form Styles */
        .receipt-section {
            background-color: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #eee;
        }

        .receipt-section h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 20px;
            font-weight: 600;
            color: #0B6A27;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e0e0e0;
        }

        .receipt-section p {
            font-size: 16px;
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .receipt-section p strong {
            color: #333;
            display: inline-block;
            min-width: 180px; /* Adjust as needed for alignment */
            margin-right: 10px;
        }

        .receipt-medication-item {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
        }

        /* Thank You Message */
        .thank-you-container {
            background-color: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            text-align: center;
            display: none;
            margin-right: 0;
            /* Adjusted for full width on smaller screens */
        }

        .thank-you-container h2 {
            font-family: 'Poppins', sans-serif;
            font-size: 28px;
            font-weight: 700;
            color: #0B6A27;
            margin-bottom: 20px;
        }

        .thank-you-container p {
            font-size: 18px;
            color: #333;
            margin-bottom: 20px;
        }

        .thank-you-container .btn {
            display: inline-block;
            margin-top: 20px;
        }

        /* Password Setup Modal */
        .password-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .password-modal.active {
            display: flex;
        }

        .password-modal-content {
            background-color: white;
            border-radius: 15px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .password-modal h2 {
            font-family: 'Poppins', sans-serif;
            font-size: 24px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .password-modal p {
            color: #666;
            margin-bottom: 20px;
            text-align: center;
        }

        .password-strength {
            margin-top: 10px;
            font-size: 14px;
        }

        .strength-weak { color: #dc3545; }
        .strength-medium { color: #ffc107; }
        .strength-strong { color: #28a745; }

        /* Hide all forms initially except the first one */
        .form-container {
            display: none;
        }

        #personalInfoForm {
            display: block; /* This will be the first displayed form */
        }

        /* Responsive adjustments */
        @media (max-width: 1024px) {
            .main-content {
                margin-left: 0;
            }

            /* On smaller screens, allow form-row form-groups to stack */
            .form-row > .form-group {
                flex-direction: column;
                align-items: flex-start;
                flex: 0 0 100%;
                max-width: 100%;
            }
            .form-row > .form-group label {
                width: auto;
                /* Let label width be natural */
                text-align: left;
                padding-right: 0;
                margin-bottom: 8px; /* Add back spacing */
            }
            .form-row > .form-group input,
            .form-row > .form-group select,
            .form-row > .form-group textarea {
                width: 100%;
            }

            .progress-steps {
                font-size: 10px;
            }
        }

        @media (max-width: 768px) {
            .navbar-container header {
                padding: 0 20px;
            }

            .form-container {
                padding: 20px;
                margin-right: 0;
            }

            .progress-container {
                margin-right: 0;
            }

            .dashboard-header h1 {
                margin-left: 0;
            }

            .dashboard-header p {
                margin-left: 0;
            }

            /* Adjusted for stacked medication fields on smaller screens */
            .medication-row {
                padding: 10px; /* Slightly less padding on smaller screens */
            }
            .medication-row .form-group {
                margin-bottom: 10px;
            }
            /* Adjust remove button for smaller screens (it's already block, but ensure full width) */
            .medication-row .button-container {
                justify-content: center; /* Center button on small screens */
            }
            .medication-row .remove-medication-btn {
                width: 100%; /* Make button full width if centered */
            }

            .unit-input {
                flex-direction: column;
                align-items: stretch;
            }
            .unit-input input, .unit-input select {
                width: 100%;
                /* Ensure they take full width when stacked */
            }

            /* Revert general form-group to block display on smaller screens for stacking */
            .form-container .form-group:not(.form-row .form-group) {
                flex-direction: column;
                align-items: flex-start;
            }
            .form-container .form-group:not(.form-row .form-group) label {
                width: auto;
                text-align: left;
                padding-right: 0;
                margin-bottom: 8px;
            }
            .form-container .form-group:not(.form-row .form-group) input,
            .form-container .form-group:not(.form-row .form-group) select {
                width: 100%;
            }
        }

        @media (max-width: 576px) {
            .main-content {
                padding: 20px;
            }

            .form-navigation {
                flex-direction: column;
                gap: 10px;
            }

            .btn {
                width: 100%;
            }
            /* Make button-container span full width if it's the only element in a column layout */
            .personal-info-button-container {
                justify-content: center;
                /* Center button on very small screens */
                padding-right: 0;
            }

            .radio-group {
                flex-direction: column;
                gap: 10px;
            }

            .checkbox-grid {
                grid-template-columns: 1fr;
            }

            .receipt-section p strong {
                min-width: 120px;
                /* Adjust for smaller screens */
            }
        }
    </style>
</head>

<body>
    <div class="navbar-container">
        <header>
            <div class="hospital-container">
                <div class="logo-container">
                    <img src="logoright.jpg" alt="Logo Right" />
                </div>
                <div class="logo-container">
                    <img src="logoleft.jpg" alt="Logo Left" />
                </div>
                <div class="hospital-name">
                    <p class="hospital-line">Sebaste Community</p>
                    <p class="hospital-line">Hospital</p>
                </div>
            </div>
        </header>
    </div>

    <div class="dashboard-container">
        <main class="main-content">
            <div class="dashboard-header">
                <h1>Medical Registration</h1>
                <p>Kindly fill in the form below to submit your medical background and relevant details.</p>
            </div>

            <div class="appointment-container">
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-steps">
                        <div class="progress-step active" id="step1">Personal Info</div>
                        <div class="progress-step" id="step2">Health Info</div>
                        <div class="progress-step" id="step3">Emergency Contact</div>
                        <div class="progress-step" id="step4">Medical Conditions</div>
                        <div class="progress-step" id="step5">Health Details</div>
                        <div class="progress-step" id="step6">Lifestyle</div>
                        <div class="progress-step" id="step7">Vaccination</div>
                        <div class="progress-step" id="step8">Complete</div>
                    </div>
                </div>

                <div class="form-container" id="personalInfoForm">
                    <h2 class="form-title">Personal Information</h2>
                    <div class="form-group">
                        <label for="firstName" class="required">First Name</label>
                        <input type="text" id="firstName" name="firstName" required>
                    </div>
                    <div class="form-group">
                        <label for="middleName">Middle Name</label>
                        <input type="text" id="middleName" name="middleName">
                    </div>
                    <div class="form-group">
                        <label for="lastName" class="required">Last Name</label>
                        <input type="text" id="lastName" name="lastName" required>
                    </div>

                    <div class="form-group">
                        <label for="addressLine1" class="required">House No. / Street</label>
                        <input type="text" id="addressLine1" name="addressLine1" placeholder="House No., Street" required>
                    </div>

                    <div class="form-group">
                        <label for="city" class="required">City/Municipality</label>
                        <input type="text" id="city" name="city" placeholder="City or Municipality" required>
                    </div>
                    <div class="form-group">
                        <label for="province" class="required">Province</label>
                        <input type="text" id="province" name="province" placeholder="Province" required>
                    </div>
                    <div class="form-group">
                        <label for="postalCode" class="required">Postal Code</label>
                        <input type="text" id="postalCode" name="postalCode" placeholder="Code" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="mobileNumber" class="required">Mobile Number</label>
                        <input type="tel" id="mobileNumber" name="mobileNumber" required>
                    </div>
                    <div class="form-group">
                        <label for="birthday" class="required">Birthday</label>
                        <input type="date" id="birthday" name="birthday" required max="">
                        <div id="ageDisplay" class="age-display" style="display: none;">
                            Age: <span id="calculatedAge">0</span> 
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="gender" class="required">Gender</label>
                        <select id="gender" name="gender" required>
                            <option value="">Select Gender</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="email" class="required">Email Address</label>
                        <input type="email" id="email" name="email" required>
                    </div>
                    
                    <div class="personal-info-button-container">
                        <button type="button" class="btn btn-next" onclick="nextForm(1)">Next</button>
                    </div>
                </div>

                <div class="form-container" id="healthInfoForm">
                    <h2 class="form-title">Basic Health Information</h2>
                    <div class="form-group">
                        <label for="bloodType" class="required">Blood Type</label>
                        <select id="bloodType" name="bloodType" required>
                            <option value="">Select Blood Type</option>
                            <option value="A+">A+</option>
                            <option value="A-">A-</option>
                            <option value="B+">B+</option>
                            <option value="B-">B-</option>
                            <option value="AB+">AB+</option>
                            <option value="AB-">AB-</option>
                            <option value="O+">O+</option>
                            <option value="O-">O-</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="height" class="required">Height</label>
                        <div class="unit-input">
                            <input type="number" id="height" name="height" step="0.1" required min="1">
                            <select id="heightUnit" name="heightUnit">
                                <option value="cm">cm</option>
                                <option value="in">inches</option>
                                <option value="ft">feet</option>
                            </select>
                        </div>
                        <div id="heightConversionDisplay" style="margin-top: 5px; font-size: 0.9em; color: #555;"></div>
                    </div>
                    <div class="form-group">
                        <label for="weight" class="required">Weight</label>
                        <div class="unit-input">
                            <input type="number" id="weight" name="weight" step="0.1" required min="1">
                            <select id="weightUnit" name="weightUnit">
                                <option value="kg">kg</option>
                                <option value="lbs">lbs</option>
                            </select>
                        </div>
                        <div id="weightConversionDisplay" style="margin-top: 5px; font-size: 0.9em; color: #555;"></div>
                    </div>
                    <div class="form-group">
                        <label for="disabilities">Disabilities and/or Impairments</label>
                        <textarea id="disabilities" name="disabilities" rows="3" placeholder="Please specify any disabilities or impairments"></textarea>
                    </div>
                    <div class="form-navigation">
                        <button type="button" class="btn btn-prev" onclick="prevForm(1)">Previous</button>
                        <button type="button" class="btn btn-next" onclick="nextForm(2)">Next</button>
                    </div>
                </div>

                <div class="form-container" id="emergencyContactForm">
                    <h2 class="form-title">Emergency Contact</h2>
                    <div class="form-group">
                        <label for="emergencyContactName" class="required">Emergency Contact Name</label>
                        <input type="text" id="emergencyContactName" name="emergencyContactName" required>
                    </div>
                    <div class="form-group">
                        <label for="emergencyContactNumber" class="required">Mobile Phone Number</label>
                        <input type="tel" id="emergencyContactNumber" name="emergencyContactNumber" required>
                    </div>
                    <div class="form-group">
                        <label for="emergencyRelationship" class="required">Relationship</label>
                        <select id="emergencyRelationship" name="emergencyRelationship" required>
                            <option value="">Select Relationship</option>
                            <option value="Spouse">Spouse</option>
                            <option value="Parent">Parent</option>
                            <option value="Child">Child</option>
                            <option value="Sibling">Sibling</option>
                            <option value="Friend">Friend</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-navigation">
                        <button type="button" class="btn btn-prev" onclick="prevForm(2)">Previous</button>
                        <button type="button" class="btn btn-next" onclick="nextForm(3)">Next</button>
                    </div>
                </div>

                <div class="form-container" id="medicalConditionsForm">
                    <h2 class="form-title">Past Medical Conditions</h2>
                    <p style="margin-bottom: 20px; color: #666;">Please check all conditions that apply to you:</p>
                    <div class="checkbox-grid">
                        <div class="checkbox-group">
                            <input type="checkbox" id="hypertension" name="medicalConditions" value="Hypertension">
                            <label for="hypertension">Hypertension</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="diabetes" name="medicalConditions" value="Diabetes">
                            <label for="diabetes">Diabetes</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="asthma" name="medicalConditions" value="Asthma">
                            <label for="asthma">Asthma</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="heartDisease" name="medicalConditions" value="Heart Disease">
                            <label for="heartDisease">Heart Disease</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="tuberculosis" name="medicalConditions" value="Tuberculosis">
                            <label for="tuberculosis">Tuberculosis</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="seizures" name="medicalConditions" value="Seizures">
                            <label for="seizures">Seizures</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="cancer" name="medicalConditions" value="Cancer">
                            <label for="cancer">Cancer</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="stroke" name="medicalConditions" value="Stroke">
                            <label for="stroke">Stroke</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="mentalHealth" name="medicalConditions" value="Mental Health Issues (e.g., Depression, Anxiety)">
                            <label for="mentalHealth">Mental Health Issues (e.g., Depression, Anxiety)</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="otherCondition" name="medicalConditions" value="Other">
                            <label for="otherCondition">Other</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="otherConditionDetails">If Other, please specify:</label>
                        <textarea id="otherConditionDetails" name="otherConditionDetails" rows="3" placeholder="Please specify other medical conditions"></textarea>
                    </div>
                    <div class="form-navigation">
                        <button type="button" class="btn btn-prev" onclick="prevForm(3)">Previous</button>
                        <button type="button" class="btn btn-next" onclick="nextForm(4)">Next</button>
                    </div>
                </div>

                <div class="form-container" id="healthDetailsForm">
                    <h2 class="form-title">Other Health Details</h2>
                    <div class="form-group">
                        <label>Have you had any surgeries?</label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="hasSurgeries" value="Yes" onchange="toggleSurgeryDetails(true)"> Yes
                            </label>
                            <label>
                                <input type="radio" name="hasSurgeries" value="No" onchange="toggleSurgeryDetails(false)" > No
                            </label>
                        </div>
                    </div>
                    <div class="form-group" id="surgeryDetailsGroup" style="display: none;">
                        <label for="surgeryDetails">If Yes, please specify:</label>
                        <textarea id="surgeryDetails" name="surgeryDetails" rows="3" placeholder="Details of surgeries"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Do you have any allergies?</label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="hasAllergies" value="Yes" onchange="toggleAllergyDetails(true)"> Yes
                            </label>
                            <label>
                                <input type="radio" name="hasAllergies" value="No" onchange="toggleAllergyDetails(false)"> No
                            </label>
                        </div>
                    </div>
                    <div class="form-group" id="allergyDetailsGroup" style="display: none;">
                        <label for="allergyDetails">If Yes, please specify:</label>
                        <textarea id="allergyDetails" name="allergyDetails" rows="3" placeholder="Details of allergies"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Are you currently taking any medications?</label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="onMedications" value="Yes" onchange="toggleMedicationFields(true)"> Yes
                            </label>
                            <label>
                                <input type="radio" name="onMedications" value="No" onchange="toggleMedicationFields(false)"> No
                            </label>
                        </div>
                    </div>
                    <div id="medicationFields" style="display: none;">
                        <div id="medicationsContainer">
                        </div>
                        <button type="button" class="add-medication-btn" onclick="addMedicationField()">Add Medication</button>
                    </div>
                    <div class="form-navigation">
                        <button type="button" class="btn btn-prev" onclick="prevForm(4)">Previous</button>
                        <button type="button" class="btn btn-next" onclick="nextForm(5)">Next</button>
                    </div>
                </div>

                <div class="form-container" id="lifestyleForm">
                    <h2 class="form-title">Lifestyle Information</h2>
                    <div class="form-group">
                        <label>Do you smoke?</label>
                        <div class="radio-group">
                            <label><input type="radio" name="smoke" value="Yes"> Yes</label>
                            <label><input type="radio" name="smoke" value="No"> No</label>
                            <label><input type="radio" name="smoke" value="Quit"> Quit (When?)</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Do you consume alcohol?</label>
                        <div class="radio-group">
                            <label><input type="radio" name="alcohol" value="Yes"> Yes</label>
                            <label><input type="radio" name="alcohol" value="No"> No</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Do you exercise regularly?</label>
                        <div class="radio-group">
                            <label><input type="radio" name="exercise" value="Yes"> Yes</label>
                            <label><input type="radio" name="exercise" value="No"> No</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Do you drink enough water daily?</label>
                        <div class="radio-group">
                            <label><input type="radio" name="water" value="Yes"> Yes</label>
                            <label><input type="radio" name="water" value="No"> No</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="diet">What is your typical diet?</label>
                        <textarea id="diet" name="diet" rows="3" placeholder="e.g., Vegetarian, Balanced, High-protein, etc."></textarea>
                    </div>
                    <div class="form-navigation">
                        <button type="button" class="btn btn-prev" onclick="prevForm(5)">Previous</button>
                        <button type="button" class="btn btn-next" onclick="nextForm(6)">Next</button>
                    </div>
                </div>

                <div class="form-container" id="vaccinationForm">
                    <h2 class="form-title">Vaccination Information</h2>
                    <p style="margin-bottom: 20px; color: #666;">Please provide details about your vaccinations.</p>
                    <div class="form-group">
                        <label for="covidVaccine">COVID-19 Vaccine (Type & Doses)</label>
                        <input type="text" id="covidVaccine" name="covidVaccine" placeholder="e.g., Pfizer (2 doses), Moderna (1 dose)">
                    </div>
                    <div class="form-group">
                        <label for="fluVaccineDate">Last Flu Vaccine Date</label>
                        <input type="date" id="fluVaccineDate" name="fluVaccineDate">
                    </div>
                    <div class="form-group">
                        <label for="tetanusVaccineDate">Last Tetanus Vaccine Date</label>
                        <input type="date" id="tetanusVaccineDate" name="tetanusVaccineDate">
                    </div>
                    <div class="form-group">
                        <label for="otherVaccines">Other Vaccinations (Please specify)</label>
                        <textarea id="otherVaccines" name="otherVaccines" rows="3" placeholder="e.g., Hepatitis B, MMR, etc."></textarea>
                    </div>
                    <div class="form-navigation">
                        <button type="button" class="btn btn-prev" onclick="prevForm(6)">Previous</button>
                        <button type="button" class="btn btn-next" onclick="nextForm(7)">Next</button>
                    </div>
                </div>

                <div class="form-container" id="completeForm">
                    <h2 class="form-title">Review and Complete</h2>
                    <p style="margin-bottom: 20px; color: #666;">Please review your information before submitting.</p>
                    <div class="receipt-section">
                        <h3>Personal Information</h3>
                        <p><strong>Name:</strong> <span id="reviewFullName"></span></p>
                        <p><strong>Address:</strong> <span id="reviewAddress"></span></p>
                        <p><strong>Mobile Number:</strong> <span id="reviewMobileNumber"></span></p>
                        <p><strong>Birthday:</strong> <span id="reviewBirthday"></span> (<span id="reviewAge"></span>)</p>
                        <p><strong>Gender:</strong> <span id="reviewGender"></span></p>
                        <p><strong>Email:</strong> <span id="reviewEmail"></span></p>
                    </div>
                    <div class="receipt-section">
                        <h3>Basic Health Information</h3>
                        <p><strong>Blood Type:</strong> <span id="reviewBloodType"></span></p>
                        <p><strong>Height:</strong> <span id="reviewHeight"></span></p>
                        <p><strong>Weight:</strong> <span id="reviewWeight"></span></p>
                        <p><strong>Disabilities/Impairments:</strong> <span id="reviewDisabilities"></span></p>
                    </div>
                    <div class="receipt-section">
                        <h3>Emergency Contact</h3>
                        <p><strong>Name:</strong> <span id="reviewEmergencyName"></span></p>
                        <p><strong>Mobile Number:</strong> <span id="reviewEmergencyNumber"></span></p>
                        <p><strong>Relationship:</strong> <span id="reviewEmergencyRelationship"></span></p>
                    </div>
                    <div class="receipt-section">
                        <h3>Past Medical Conditions</h3>
                        <p><strong>Conditions:</strong> <span id="reviewMedicalConditions"></span></p>
                        <p id="reviewOtherConditionDetailsContainer"><strong>Other Details:</strong> <span id="reviewOtherConditionDetails"></span></p>
                    </div>
                    <div class="receipt-section">
                        <h3>Other Health Details</h3>
                        <p><strong>Surgeries:</strong> <span id="reviewSurgeries"></span></p>
                        <p id="reviewSurgeryDetailsContainer"><strong>Surgery Details:</strong> <span id="reviewSurgeryDetails"></span></p>
                        <p><strong>Allergies:</strong> <span id="reviewAllergies"></span></p>
                        <p id="reviewAllergyDetailsContainer"><strong>Allergy Details:</strong> <span id="reviewAllergyDetails"></span></p>
                        <p><strong>Medications:</strong> <span id="reviewMedications"></span></p>
                        <div id="reviewMedicationList"></div>
                    </div>
                    <div class="receipt-section">
                        <h3>Lifestyle Information</h3>
                        <p><strong>Smoke:</strong> <span id="reviewSmoke"></span></p>
                        <p><strong>Alcohol:</strong> <span id="reviewAlcohol"></span></p>
                        <p><strong>Exercise:</strong> <span id="reviewExercise"></span></p>
                        <p><strong>Water Intake:</strong> <span id="reviewWater"></span></p>
                        <p><strong>Diet:</strong> <span id="reviewDiet"></span></p>
                    </div>
                    <div class="receipt-section">
                        <h3>Vaccination Information</h3>
                        <p><strong>COVID-19 Vaccine:</strong> <span id="reviewCovidVaccine"></span></p>
                        <p><strong>Last Flu Vaccine:</strong> <span id="reviewFluVaccineDate"></span></p>
                        <p><strong>Last Tetanus Vaccine:</strong> <span id="reviewTetanusVaccineDate"></span></p>
                        <p><strong>Other Vaccinations:</strong> <span id="reviewOtherVaccines"></span></p>
                    </div>
                    <div class="form-navigation">
                        <button type="button" class="btn btn-prev" onclick="prevForm(7)">Previous</button>
                        <button type="button" class="btn btn-submit" onclick="showPasswordModal()">Submit</button>
                    </div>
                </div>
                
                <div class="thank-you-container" id="thankYouMessage">
                    <h2>Thank You for Registering!</h2>
                    <p>Your medical information has been successfully submitted. You can now log in to access your health profile.</p>
                    <button class="btn btn-next" onclick="window.location.href='index.html'">Go to Login</button>
                </div>
            </div>
        </main>
    </div>

    <div class="password-modal" id="passwordModal">
        <div class="password-modal-content">
            <h2>Set Up Your Password</h2>
            <p>For security, please create a password to protect your registration details. This will be used for future access.</p>
            <div class="form-group">
                <label for="passwordInput" class="required">Password</label>
                <input type="password" id="passwordInput" name="passwordInput" required onkeyup="checkPasswordStrength()">
                <div id="passwordStrength" class="password-strength"></div>
            </div>
            <div class="form-group">
                <label for="confirmPasswordInput" class="required">Confirm Password</label>
                <input type="password" id="confirmPasswordInput" name="confirmPasswordInput" required>
            </div>
            <div class="form-navigation">
                <button type="button" class="btn btn-prev" onclick="closePasswordModal()">Cancel</button>
                <button type="button" class="btn btn-submit" onclick="submitForm()">Set Password & Complete</button>
            </div>
        </div>
    </div>

    <script>
        const forms = document.querySelectorAll('.form-container');
        const progressSteps = document.querySelectorAll('.progress-step');
        const progressFill = document.getElementById('progressFill');
        let currentFormIndex = 0;
        
        // Store form data for persistence between steps
        const formDataStore = {};

        // Set max date for birthday input to today
        document.addEventListener('DOMContentLoaded', () => {
            const today = new Date();
            const year = today.getFullYear();
            const month = (today.getMonth() + 1).toString().padStart(2, '0');
            const day = today.getDate().toString().padStart(2, '0');
            document.getElementById('birthday').max = `${year}-${month}-${day}`;
            
            // Initialize first form
            showForm(0);
        });

        function showForm(index) {
            // Save current form data before switching
            if (currentFormIndex !== index) {
                saveCurrentFormData();
            }
            
            forms.forEach((form, i) => {
                form.style.display = i === index ? 'block' : 'none';
                if (i === index) {
                    form.style.opacity = 1;
                    form.style.transform = 'translateX(0)';
                } else {
                    form.style.opacity = 0;
                    form.style.transform = 'translateX(100%)';
                }
            });
            
            updateProgressBar(index);
            currentFormIndex = index;
            
            // Restore form data for the current form
            restoreFormData(index);

            // Trigger specific form initializations
            if (currentFormIndex === 0) { // Personal Info form
                calculateAge();
            } else if (currentFormIndex === 1) { // Health Info form
                convertHeight();
                convertWeight();
            }
        }

        function updateProgressBar(index) {
            const totalForms = forms.length;
            // Fixed progress calculation - should go from 0% to 100%
            const progress = ((index + 1) / totalForms) * 100;
            progressFill.style.width = `${progress}%`;

            progressSteps.forEach((step, i) => {
                if (i < index) {
                    step.classList.add('completed');
                    step.classList.remove('active');
                } else if (i === index) {
                    step.classList.add('active');
                    step.classList.remove('completed');
                } else {
                    step.classList.remove('active', 'completed');
                }
            });
        }

        function saveCurrentFormData() {
            const currentForm = forms[currentFormIndex];
            if (!currentForm) return;
            
            const inputs = currentForm.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                if (input.type === 'radio') {
                    if (input.checked) {
                        formDataStore[input.name] = input.value;
                    }
                } else if (input.type === 'checkbox') {
                    if (!formDataStore[input.name]) {
                        formDataStore[input.name] = [];
                    }
                    if (input.checked && !formDataStore[input.name].includes(input.value)) {
                        formDataStore[input.name].push(input.value);
                    } else if (!input.checked) {
                        const index = formDataStore[input.name].indexOf(input.value);
                        if (index > -1) {
                            formDataStore[input.name].splice(index, 1);
                        }
                    }
                } else if (input.id || input.name) {
                    formDataStore[input.id || input.name] = input.value;
                }
            });
            
            // Save medication data specially
            if (currentFormIndex === 4) { // Health Details form
                const medicationRows = document.querySelectorAll('#medicationsContainer .medication-row');
                formDataStore.medications = [];
                medicationRows.forEach((row, index) => {
                    const name = row.querySelector(`#medicationName${index + 1}`)?.value || '';
                    const dosage = row.querySelector(`#dosage${index + 1}`)?.value || '';
                    const frequency = row.querySelector(`#frequency${index + 1}`)?.value || '';
                    if (name || dosage || frequency) {
                        formDataStore.medications.push({ name, dosage, frequency });
                    }
                });
            }
        }

        function restoreFormData(index) {
            const currentForm = forms[index];
            if (!currentForm) return;
            
            const inputs = currentForm.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                const key = input.id || input.name;
                if (formDataStore[key] !== undefined) {
                    if (input.type === 'radio') {
                        input.checked = formDataStore[input.name] === input.value;
                    } else if (input.type === 'checkbox') {
                        input.checked = formDataStore[input.name]?.includes(input.value) || false;
                    } else {
                        input.value = formDataStore[key];
                    }
                }
            });
            
            // Restore medication data
            if (index === 4 && formDataStore.medications) {
                const container = document.getElementById('medicationsContainer');
                container.innerHTML = '';
                medicationCounter = 0;
                
                formDataStore.medications.forEach(med => {
                    addMedicationField();
                    const lastRow = container.lastElementChild;
                    if (lastRow) {
                        const nameInput = lastRow.querySelector(`#medicationName${medicationCounter}`);
                        const dosageInput = lastRow.querySelector(`#dosage${medicationCounter}`);
                        const frequencyInput = lastRow.querySelector(`#frequency${medicationCounter}`);
                        
                        if (nameInput) nameInput.value = med.name || '';
                        if (dosageInput) dosageInput.value = med.dosage || '';
                        if (frequencyInput) frequencyInput.value = med.frequency || '';
                    }
                });
            }
            
            // Restore conditional field visibility
            if (index === 4) { // Health Details form
                const hasSurgeries = document.querySelector('input[name="hasSurgeries"]:checked');
                if (hasSurgeries) toggleSurgeryDetails(hasSurgeries.value === 'Yes');
                
                const hasAllergies = document.querySelector('input[name="hasAllergies"]:checked');
                if (hasAllergies) toggleAllergyDetails(hasAllergies.value === 'Yes');
                
                const onMedications = document.querySelector('input[name="onMedications"]:checked');
                if (onMedications) toggleMedicationFields(onMedications.value === 'Yes');
            }
        }

        function validateForm(index) {
            const currentForm = forms[index];
            const requiredInputs = currentForm.querySelectorAll('[required]');
            let allValid = true;

            requiredInputs.forEach(input => {
                if (input.type === 'radio') {
                    const name = input.name;
                    const radioGroup = document.querySelector(`input[name="${name}"]:checked`);
                    if (!radioGroup) {
                        allValid = false;
                        input.style.borderColor = 'red';
                    } else {
                        input.style.borderColor = '';
                    }
                } else if (input.id === 'birthday') {
                    const birthdayInput = document.getElementById('birthday');
                    const birthdayValue = new Date(birthdayInput.value);
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);

                    if (!birthdayInput.value || birthdayValue >= today) {
                        allValid = false;
                        birthdayInput.style.borderColor = 'red';
                    } else {
                        birthdayInput.style.borderColor = '';
                    }
                } else if (input.id === 'height' || input.id === 'weight') {
                    const value = parseFloat(input.value);
                    if (isNaN(value) || value < 1) {
                        allValid = false;
                        input.style.borderColor = 'red';
                    } else {
                        input.style.borderColor = '';
                    }
                } else if (!input.value.trim()) {
                    allValid = false;
                    input.style.borderColor = 'red';
                } else {
                    input.style.borderColor = '';
                }
            });

            // Special validation for medication inputs if the medication section is active
            if (currentForm.id === 'healthDetailsForm' && document.querySelector('input[name="onMedications"]:checked')?.value === 'Yes') {
                const medicationRows = document.querySelectorAll('#medicationsContainer .medication-row');
                medicationRows.forEach(row => {
                    const nameInput = row.querySelector('input[name^="medicationName"]');
                    const dosageInput = row.querySelector('input[name^="dosage"]');
                    const frequencyInput = row.querySelector('input[name^="frequency"]');

                    if (!nameInput.value.trim()) {
                        allValid = false;
                        nameInput.style.borderColor = 'red';
                    } else {
                        nameInput.style.borderColor = '';
                    }
                    if (!dosageInput.value.trim()) {
                        allValid = false;
                        dosageInput.style.borderColor = 'red';
                    } else {
                        dosageInput.style.borderColor = '';
                    }
                    if (!frequencyInput.value.trim()) {
                        allValid = false;
                        frequencyInput.style.borderColor = 'red';
                    } else {
                        frequencyInput.style.borderColor = '';
                    }
                });
            }

            return allValid;
        }

        function nextForm(nextIndex) {
            if (validateForm(currentFormIndex)) {
                if (nextIndex < forms.length) {
                    showForm(nextIndex);
                    // Special handling for the complete form (last step)
                    if (nextIndex === forms.length - 1) {
                        populateReview();
                    }
                }
            } else {
                alert('Please fill in all required fields correctly before proceeding.');
            }
        }

        // Replace the existing prevForm function with this
function prevForm() {
    if (currentFormIndex > 0) {
        showForm(currentFormIndex - 1);
    }
}

        // Birthday Logic
        const birthdayInput = document.getElementById('birthday');
        const ageDisplay = document.getElementById('ageDisplay');
        const calculatedAgeSpan = document.getElementById('calculatedAge');

        birthdayInput.addEventListener('change', calculateAge);

        function calculateAge() {
            const birthdayValue = birthdayInput.value;
            if (!birthdayValue) {
                ageDisplay.style.display = 'none';
                return;
            }

            const birthDate = new Date(birthdayValue);
            const today = new Date();
            
            // Validate against future dates
            if (birthDate >= today) {
                calculatedAgeSpan.textContent = "Invalid (Future date)";
                ageDisplay.style.display = 'block';
                return;
            }

            let ageString = '';
            
            // Calculate difference in milliseconds
            const diffMs = today.getTime() - birthDate.getTime();

            // Convert to days
            const days = Math.floor(diffMs / (1000 * 60 * 60 * 24));

            // If less than a year (approximately 365 days)
            if (days < 365) {
                const months = Math.floor(days / 30.4375); // Average days in a month
                if (months === 0) { // Less than one month old
                    ageString = `${days} day${days === 1 ? '' : 's'} old`;
                } else { // One month to less than a year
                    ageString = `${months} month${months === 1 ? '' : 's'} old`;
                }
            } else { // One year or older
                let ageYears = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();
                const dayDiff = today.getDate() - birthDate.getDate();

                // Adjust age if birthday hasn't occurred yet this year
                if (monthDiff < 0 || (monthDiff === 0 && dayDiff < 0)) {
                    ageYears--;
                }
                ageString = `${ageYears} year${ageYears === 1 ? '' : 's'} old`;
            }

            calculatedAgeSpan.textContent = ageString;
            ageDisplay.style.display = 'block';
        }

        // Height & Weight Logic
        const heightInput = document.getElementById('height');
        const heightUnitSelect = document.getElementById('heightUnit');
        const heightConversionDisplay = document.getElementById('heightConversionDisplay');

        const weightInput = document.getElementById('weight');
        const weightUnitSelect = document.getElementById('weightUnit');
        const weightConversionDisplay = document.getElementById('weightConversionDisplay');

        heightInput.addEventListener('input', convertHeight);
        heightUnitSelect.addEventListener('change', convertHeight);
        weightInput.addEventListener('input', convertWeight);
        weightUnitSelect.addEventListener('change', convertWeight);

        function convertHeight() {
            const value = parseFloat(heightInput.value);
            const unit = heightUnitSelect.value;
            let displayString = '';

            if (isNaN(value) || value < 1) {
                heightConversionDisplay.textContent = 'Please enter a valid height (min 1).';
                return;
            }

            if (unit === 'cm') {
                const inches = (value / 2.54).toFixed(2);
                const feet = (value / 30.48).toFixed(2);
                displayString = `~ ${inches} inches, ~ ${feet} feet`;
            } else if (unit === 'in') {
                const cm = (value * 2.54).toFixed(2);
                const feet = (value / 12).toFixed(2);
                displayString = `~ ${cm} cm, ~ ${feet} feet`;
            } else if (unit === 'ft') {
                const cm = (value * 30.48).toFixed(2);
                const inches = (value * 12).toFixed(2);
                displayString = `~ ${cm} cm, ~ ${inches} inches`;
            }
            heightConversionDisplay.textContent = displayString;
        }

        function convertWeight() {
            const value = parseFloat(weightInput.value);
            const unit = weightUnitSelect.value;
            let displayString = '';

            if (isNaN(value) || value < 1) {
                weightConversionDisplay.textContent = 'Please enter a valid weight (min 1).';
                return;
            }

            if (unit === 'kg') {
                const lbs = (value * 2.20462).toFixed(2);
                displayString = `~ ${lbs} lbs`;
            } else if (unit === 'lbs') {
                const kg = (value / 2.20462).toFixed(2);
                displayString = `~ ${kg} kg`;
            }
            weightConversionDisplay.textContent = displayString;
        }

        // Dynamic Textarea Sizing
        document.querySelectorAll('textarea').forEach(textarea => {
            textarea.addEventListener('input', autoResizeTextarea);
        });

        function autoResizeTextarea() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        }

        // Optional Fields Logic
        function toggleSurgeryDetails(show) {
            document.getElementById('surgeryDetailsGroup').style.display = show ? 'flex' : 'none';
            document.getElementById('surgeryDetails').required = show;
        }

        function toggleAllergyDetails(show) {
            document.getElementById('allergyDetailsGroup').style.display = show ? 'flex' : 'none';
            document.getElementById('allergyDetails').required = show;
        }

        function toggleMedicationFields(show) {
            document.getElementById('medicationFields').style.display = show ? 'block' : 'none';
            // If hiding, clear current medications and ensure no required fields are left
            if (!show) {
                document.getElementById('medicationsContainer').innerHTML = '';
            }
        }

        // Add/Remove Medication Fields
        let medicationCounter = 0;
        function addMedicationField() {
            medicationCounter++;
            const container = document.getElementById('medicationsContainer');
            const newMedicationRow = document.createElement('div');
            newMedicationRow.classList.add('medication-row');
            newMedicationRow.innerHTML = `
                <div class="form-group">
                    <label for="medicationName${medicationCounter}">Medication Name</label>
                    <input type="text" id="medicationName${medicationCounter}" name="medicationName${medicationCounter}" placeholder="e.g., Aspirin" required>
                </div>
                <div class="form-group">
                    <label for="dosage${medicationCounter}">Dosage</label>
                    <input type="text" id="dosage${medicationCounter}" name="dosage${medicationCounter}" placeholder="e.g., 100mg" required>
                </div>
                <div class="form-group">
                    <label for="frequency${medicationCounter}">Frequency</label>
                    <input type="text" id="frequency${medicationCounter}" name="frequency${medicationCounter}" placeholder="e.g., Once daily" required>
                </div>
                <div class="button-container"> <button type="button" class="remove-medication-btn" onclick="removeMedicationField(this)">Remove</button>
                </div>
            `;
            container.appendChild(newMedicationRow);
        }

        function removeMedicationField(button) {
            button.closest('.medication-row').remove();
        }

        // Populate Review Form
        function populateReview() {
            // Personal Info
            document.getElementById('reviewFullName').textContent = 
                `${document.getElementById('firstName').value} ${document.getElementById('middleName').value} ${document.getElementById('lastName').value}`;
            document.getElementById('reviewAddress').textContent = 
                `${document.getElementById('addressLine1').value}, ${document.getElementById('city').value}, ${document.getElementById('province').value}, ${document.getElementById('postalCode').value}`;
            document.getElementById('reviewMobileNumber').textContent = document.getElementById('mobileNumber').value;
            document.getElementById('reviewBirthday').textContent = document.getElementById('birthday').value;
            document.getElementById('reviewAge').textContent = document.getElementById('calculatedAge').textContent;
            document.getElementById('reviewGender').textContent = document.getElementById('gender').value;
            document.getElementById('reviewEmail').textContent = document.getElementById('email').value;

            // Basic Health Info
            document.getElementById('reviewBloodType').textContent = document.getElementById('bloodType').value;
            // Height review: display original value + selected unit + converted values
            const heightVal = parseFloat(document.getElementById('height').value);
            const heightUnit = document.getElementById('heightUnit').value;
            let heightReviewString = `${heightVal} ${heightUnit}`;
            if (!isNaN(heightVal) && heightVal >= 1) {
                if (heightUnit === 'cm') {
                    heightReviewString += ` (~ ${(heightVal / 2.54).toFixed(2)} inches, ~ ${(heightVal / 30.48).toFixed(2)} feet)`;
                } else if (heightUnit === 'in') {
                    heightReviewString += ` (~ ${(heightVal * 2.54).toFixed(2)} cm, ~ ${(heightVal / 12).toFixed(2)} feet)`;
                } else if (heightUnit === 'ft') {
                    heightReviewString += ` (~ ${(heightVal * 30.48).toFixed(2)} cm, ~ ${(heightVal * 12).toFixed(2)} inches)`;
                }
            }
            document.getElementById('reviewHeight').textContent = heightReviewString;

            // Weight review: display original value + selected unit + converted values
            const weightVal = parseFloat(document.getElementById('weight').value);
            const weightUnit = document.getElementById('weightUnit').value;
            let weightReviewString = `${weightVal} ${weightUnit}`;
            if (!isNaN(weightVal) && weightVal >= 1) {
                if (weightUnit === 'kg') {
                    weightReviewString += ` (~ ${(weightVal * 2.20462).toFixed(2)} lbs)`;
                } else if (weightUnit === 'lbs') {
                    weightReviewString += ` (~ ${(weightVal / 2.20462).toFixed(2)} kg)`;
                }
            }
            document.getElementById('reviewWeight').textContent = weightReviewString;
            
            document.getElementById('reviewDisabilities').textContent = document.getElementById('disabilities').value || 'N/A';

            // Emergency Contact
            document.getElementById('reviewEmergencyName').textContent = document.getElementById('emergencyContactName').value;
            document.getElementById('reviewEmergencyNumber').textContent = document.getElementById('emergencyContactNumber').value;
            document.getElementById('reviewEmergencyRelationship').textContent = document.getElementById('emergencyRelationship').value;

            // Medical Conditions
            const checkedConditions = Array.from(document.querySelectorAll('input[name="medicalConditions"]:checked'))
                                            .map(cb => cb.value)
                                            .join(', ');
            document.getElementById('reviewMedicalConditions').textContent = checkedConditions || 'None';
            const otherConditionDetails = document.getElementById('otherConditionDetails').value;
            if (otherConditionDetails) {
                document.getElementById('reviewOtherConditionDetailsContainer').style.display = 'block';
                document.getElementById('reviewOtherConditionDetails').textContent = otherConditionDetails;
            } else {
                document.getElementById('reviewOtherConditionDetailsContainer').style.display = 'none';
            }

            // Other Health Details
            const hasSurgeries = document.querySelector('input[name="hasSurgeries"]:checked')?.value || 'N/A';
            document.getElementById('reviewSurgeries').textContent = hasSurgeries;
            const surgeryDetails = document.getElementById('surgeryDetails').value;
            if (hasSurgeries === 'Yes' && surgeryDetails) {
                document.getElementById('reviewSurgeryDetailsContainer').style.display = 'block';
                document.getElementById('reviewSurgeryDetails').textContent = surgeryDetails;
            } else {
                document.getElementById('reviewSurgeryDetailsContainer').style.display = 'none';
            }

            const hasAllergies = document.querySelector('input[name="hasAllergies"]:checked')?.value || 'N/A';
            document.getElementById('reviewAllergies').textContent = hasAllergies;
            const allergyDetails = document.getElementById('allergyDetails').value;
            if (hasAllergies === 'Yes' && allergyDetails) {
                document.getElementById('reviewAllergyDetailsContainer').style.display = 'block';
                document.getElementById('reviewAllergyDetails').textContent = allergyDetails;
            } else {
                document.getElementById('reviewAllergyDetailsContainer').style.display = 'none';
            }

            const onMedications = document.querySelector('input[name="onMedications"]:checked')?.value || 'N/A';
            document.getElementById('reviewMedications').textContent = onMedications;
            const medicationsContainer = document.getElementById('reviewMedicationList');
            medicationsContainer.innerHTML = '';
            if (onMedications === 'Yes') {
                const medicationRows = document.querySelectorAll('#medicationsContainer .medication-row');
                if (medicationRows.length > 0) {
                    medicationRows.forEach((row, index) => {
                        const name = row.querySelector(`#medicationName${index + 1}`)?.value || '';
                        const dosage = row.querySelector(`#dosage${index + 1}`)?.value || '';
                        const frequency = row.querySelector(`#frequency${index + 1}`)?.value || '';
                        if (name && dosage && frequency) {
                            const p = document.createElement('p');
                            p.classList.add('receipt-medication-item');
                            p.innerHTML = `<strong>Medication ${index + 1}:</strong> ${name} (Dosage: ${dosage}, Frequency: ${frequency})`;
                            medicationsContainer.appendChild(p);
                        }
                    });
                } else {
                    const p = document.createElement('p');
                    p.textContent = 'No medications specified.';
                    medicationsContainer.appendChild(p);
                }
            } else {
                const p = document.createElement('p');
                p.textContent = 'No medications specified.';
                medicationsContainer.appendChild(p);
            }

            // Lifestyle Information
            document.getElementById('reviewSmoke').textContent = document.querySelector('input[name="smoke"]:checked')?.value || 'N/A';
            document.getElementById('reviewAlcohol').textContent = document.querySelector('input[name="alcohol"]:checked')?.value || 'N/A';
            document.getElementById('reviewExercise').textContent = document.querySelector('input[name="exercise"]:checked')?.value || 'N/A';
            document.getElementById('reviewWater').textContent = document.querySelector('input[name="water"]:checked')?.value || 'N/A';
            document.getElementById('reviewDiet').textContent = document.getElementById('diet').value || 'N/A';

            // Vaccination Information
            document.getElementById('reviewCovidVaccine').textContent = document.getElementById('covidVaccine').value || 'N/A';
            document.getElementById('reviewFluVaccineDate').textContent = document.getElementById('fluVaccineDate').value || 'N/A';
            document.getElementById('reviewTetanusVaccineDate').textContent = document.getElementById('tetanusVaccineDate').value || 'N/A';
            document.getElementById('reviewOtherVaccines').textContent = document.getElementById('otherVaccines').value || 'N/A';
        }

        // Password Modal Logic
        const passwordModal = document.getElementById('passwordModal');
        const passwordInput = document.getElementById('passwordInput');
        const confirmPasswordInput = document.getElementById('confirmPasswordInput');
        const passwordStrength = document.getElementById('passwordStrength');

        function showPasswordModal() {
            passwordModal.classList.add('active');
            passwordInput.value = '';
            confirmPasswordInput.value = '';
            passwordStrength.textContent = '';
            passwordInput.style.borderColor = '';
            confirmPasswordInput.style.borderColor = '';
        }

        function closePasswordModal() {
            passwordModal.classList.remove('active');
        }

        function checkPasswordStrength() {
            const password = passwordInput.value;
            let strength = '';
            let color = '';

            if (password.length < 6) {
                strength = 'Weak';
                color = '#dc3545';
            } else if (password.length < 10 || !/[A-Z]/.test(password) || !/[a-z]/.test(password) || !/[0-9]/.test(password)) {
                strength = 'Medium';
                color = '#ffc107';
            } else {
                strength = 'Strong';
                color = '#28a745';
            }

            passwordStrength.textContent = `Strength: ${strength}`;
            passwordStrength.style.color = color;
        }

        // UPDATED SUBMIT FORM FUNCTION - SYNCED WITH INDEX.HTML
        function submitForm() {
            const password = passwordInput.value;
            const confirmPassword = confirmPasswordInput.value;

            // Basic password validation
            if (password.length === 0 || confirmPassword.length === 0) {
                alert('Please enter and confirm your password.');
                passwordInput.style.borderColor = 'red';
                confirmPasswordInput.style.borderColor = 'red';
                return;
            }

            if (password !== confirmPassword) {
                alert('Passwords do not match. Please try again.');
                passwordInput.style.borderColor = 'red';
                confirmPasswordInput.style.borderColor = 'red';
                return;
            }

            if (passwordStrength.textContent.includes('Weak')) {
                alert('Please choose a stronger password.');
                passwordInput.style.borderColor = 'red';
                return;
            }

            // Collect and save form data
            const formData = collectFormData();
            const email = formData.email;

            try {
                // Save registration data to localStorage
                localStorage.setItem('registrationData', JSON.stringify(formData));
                localStorage.setItem('registrationComplete', 'true');
                localStorage.setItem('registrationDate', new Date().toISOString());
                
                // Save password for this user (synced with index.html)
                localStorage.setItem('userPassword_' + email, password);
                
                // Notify index.html about the password setup
                if (window.setUserPassword) {
                    window.setUserPassword(email, password);
                }

                console.log('Registration completed successfully for:', email);
            } catch (error) {
                console.error('Error saving registration data:', error);
                alert('There was an error saving your registration. Please try again.');
                return;
            }

            // If all validations pass, close modal and show thank you
            closePasswordModal();
            document.getElementById('thankYouMessage').style.display = 'block';
            forms[currentFormIndex].style.display = 'none';
            progressFill.style.width = '100%';
            progressSteps.forEach(step => step.classList.add('completed'));
            progressSteps[forms.length - 1].classList.add('active');

            console.log('Form Submitted!', formData);
        }

        function collectFormData() {
            const formData = {};
            forms.forEach(form => {
                const inputs = form.querySelectorAll('input, select, textarea');
                inputs.forEach(input => {
                    if (input.type === 'radio') {
                        if (input.checked) {
                            formData[input.name] = input.value;
                        }
                    } else if (input.type === 'checkbox') {
                        if (!formData[input.name]) {
                            formData[input.name] = [];
                        }
                        if (input.checked) {
                            formData[input.name].push(input.value);
                        }
                    } else {
                        formData[input.id] = input.value;
                    }
                });
            });

            // Special handling for medications
            formData.medications = [];
            const medicationRows = document.querySelectorAll('#medicationsContainer .medication-row');
            medicationRows.forEach((row, index) => {
                const name = row.querySelector(`#medicationName${index + 1}`)?.value || '';
                const dosage = row.querySelector(`#dosage${index + 1}`)?.value || '';
                const frequency = row.querySelector(`#frequency${index + 1}`)?.value || '';
                if (name && dosage && frequency) {
                    formData.medications.push({ name, dosage, frequency });
                }
            });

            return formData;
        }

        function resetForm() {
            // Clear localStorage
            localStorage.removeItem('registrationData');
            localStorage.removeItem('registrationComplete');
            localStorage.removeItem('registrationDate');
            
            // Clear form data store
            Object.keys(formDataStore).forEach(key => delete formDataStore[key]);
            
            // Reset all input fields
            document.querySelectorAll('input, select, textarea').forEach(input => {
                if (input.type === 'checkbox' || input.type === 'radio') {
                    input.checked = false;
                } else if (input.tagName === 'SELECT') {
                    input.value = '';
                } else if (input.tagName === 'TEXTAREA') {
                    input.value = '';
                    input.style.height = 'auto';
                } else {
                    input.value = '';
                }
                input.style.borderColor = '#ddd';
            });

            // Reset specific elements
            document.getElementById('ageDisplay').style.display = 'none';
            document.getElementById('calculatedAge').textContent = '0';
            document.getElementById('heightConversionDisplay').textContent = '';
            document.getElementById('weightConversionDisplay').textContent = '';
            document.getElementById('medicationsContainer').innerHTML = '';
            toggleSurgeryDetails(false);
            toggleAllergyDetails(false);
            toggleMedicationFields(false);
            
            // Reset radio buttons to default
            const defaultRadios = [
                'input[name="hasSurgeries"][value="No"]',
                'input[name="hasAllergies"][value="No"]',
                'input[name="onMedications"][value="No"]'
            ];
            defaultRadios.forEach(selector => {
                const radio = document.querySelector(selector);
                if (radio) radio.checked = true;
            });

            // Show the first form
            showForm(0);
            document.getElementById('thankYouMessage').style.display = 'none';
        }
    </script>
</body>
</html>
